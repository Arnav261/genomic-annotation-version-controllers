<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Genomic Annotation Version Controllers — Demo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .panel { border: 1px solid #ddd; padding: 12px; margin-bottom: 12px; border-radius: 6px; }
    pre { background: #f6f8fa; padding: 8px; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>Genomic Annotation Version Controllers — Demo</h1>

  <div class="panel">
    <h3>Single liftover</h3>
    <label>Chromosome: <input id="single-chrom" value="chr1"></label>
    <label>Pos: <input id="single-pos" value="100000" type="number"></label>
    <label>From: <input id="single-from" value="hg19"></label>
    <label>To: <input id="single-to" value="hg38"></label>
    <label>Fallback UCSC: <input id="single-fallback" type="checkbox"></label>
    <button id="run-single">Run</button>
    <div id="single-result"></div>
  </div>

  <div class="panel">
    <h3>Batch liftover (CSV/TSV)</h3>
    <input type="file" id="batch-file" accept=".csv,.tsv,.txt" />
    <label>From: <input id="batch-from" value="hg19"></label>
    <label>To: <input id="batch-to" value="hg38"></label>
    <label>Fallback UCSC: <input id="batch-fallback" type="checkbox"></label>
    <button id="run-batch">Upload & Run</button>
    <div id="batch-results"></div>
  </div>

  <div class="panel">
    <h3>Conflict resolution demo</h3>
    <textarea id="example-annotations" rows="6" style="width:100%;">[
  {"source": "db1", "value": "geneA", "evidence_score": 2.0, "description": "Annotated as geneA (high confidence) by db1"},
  {"source": "db2", "value": "geneA", "evidence_score": 1.0, "description": "Gene called geneA by db2 mapping"},
  {"source": "predictorX", "value": "geneB", "evidence_score": 0.5, "description": "Predicted as geneB; low confidence"}
]</textarea>
    <div>
      <button id="run-conflict">Deterministic resolve</button>
      <button id="run-ai">AI semantic resolve</button>
    </div>
    <div id="conflict-result"></div>
  </div>

  <div class="panel">
    <h3>Embeddings / Vector demo (ingest/search)</h3>
    <textarea id="ingest-text" rows="4" style="width:100%;">[{"id":"sample1","description":"sample annotation text","source":"demo"}]</textarea>
    <div>
      <label>Version: <input id="ingest-version" value="demo"></label>
      <label>Model: <input id="ingest-model" value="sbert"></label>
      <label>Seq type: 
        <select id="ingest-seqtype"><option value="text">text</option><option value="protein">protein</option><option value="dna">dna</option></select>
      </label>
      <button id="run-ingest">Ingest</button>
    </div>
    <div>
      <input id="search-query" placeholder="search text or sequence" style="width:60%">
      <button id="run-search">Search</button>
    </div>
    <div id="embed-results"></div>
  </div>

<script>
document.getElementById('run-single').addEventListener('click', async () => {
  const chrom = document.getElementById('single-chrom').value;
  const pos = parseInt(document.getElementById('single-pos').value, 10);
  const from = document.getElementById('single-from').value;
  const to = document.getElementById('single-to').value;
  const fallback = document.getElementById('single-fallback').checked;
  const res = await fetch('/api/liftover/single', {method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({chrom,pos,build_from:from,build_to:to,fallback_to_ucsc:fallback})});
  document.getElementById('single-result').innerHTML = `<pre>${JSON.stringify(await res.json(), null, 2)}</pre>`;
});

document.getElementById('run-batch').addEventListener('click', async () => {
  const fileEl = document.getElementById('batch-file');
  const from = document.getElementById('batch-from').value;
  const to = document.getElementById('batch-to').value;
  const fallback = document.getElementById('batch-fallback').checked;
  if (!fileEl.files.length) { alert("Select a file"); return; }
  const fd = new FormData(); fd.append('file', fileEl.files[0]);
  const res = await fetch(`/api/liftover/batch?build_from=${encodeURIComponent(from)}&build_to=${encodeURIComponent(to)}&fallback_to_ucsc=${fallback}`, {method:'POST', body: fd});
  document.getElementById('batch-results').innerHTML = `<pre>${JSON.stringify(await res.json(), null, 2)}</pre>`;
});

document.getElementById('run-conflict').addEventListener('click', async () => {
  const anns = JSON.parse(document.getElementById('example-annotations').value);
  const res = await fetch('/api/conflict/resolve_demo', {method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({annotations:anns})});
  document.getElementById('conflict-result').innerHTML = `<pre>${JSON.stringify(await res.json(), null, 2)}</pre>`;
});

document.getElementById('run-ai').addEventListener('click', async () => {
  const anns = JSON.parse(document.getElementById('example-annotations').value);
  const res = await fetch('/api/conflict/ai_resolve', {method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({annotations:anns, model:'sbert'})});
  document.getElementById('conflict-result').innerHTML = `<pre>${JSON.stringify(await res.json(), null, 2)}</pre>`;
});

document.getElementById('run-ingest').addEventListener('click', async () => {
  const txt = JSON.parse(document.getElementById('ingest-text').value);
  const version = document.getElementById('ingest-version').value;
  const model = document.getElementById('ingest-model').value;
  const seqtype = document.getElementById('ingest-seqtype').value;
  const res = await fetch('/api/embeddings/ingest', {method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({annotations: txt, version, model_key: model, seq_type: seqtype})});
  document.getElementById('embed-results').innerHTML = `<pre>${JSON.stringify(await res.json(), null, 2)}</pre>`;
});

document.getElementById('run-search').addEventListener('click', async () => {
  const q = document.getElementById('search-query').value;
  const res = await fetch('/api/embeddings/search', {method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({query:q, model_key:'sbert', top_k:10})});
  document.getElementById('embed-results').innerHTML = `<pre>${JSON.stringify(await res.json(), null, 2)}</pre>`;
});
</script>
</body>
</html>