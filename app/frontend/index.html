const base = ""; // keep empty if same origin
const API_KEY = localStorage.getItem('api_key') || '';

async function runSingle() {
  const chrom = document.getElementById('chrom').value;
  const pos = document.getElementById('pos').value;
  const from = document.getElementById('from').value;
  const to = document.getElementById('to').value;
  const url = `${base}/liftover/single?chrom=${encodeURIComponent(chrom)}&pos=${encodeURIComponent(pos)}&from_build=${encodeURIComponent(from)}&to_build=${encodeURIComponent(to)}`;
  const res = await fetch(url, { method: 'POST', headers: { 'X-API-Key': API_KEY } });
  const json = await res.json();
  document.getElementById('single-result').textContent = JSON.stringify(json, null, 2);
}

async function runBatch() {
  // read plain text or simple JSON from a textarea, or build from a small file input
  const txt = document.getElementById('batch-input').value;
  let coords;
  try {
    coords = JSON.parse(txt);
  } catch (e) {
    alert('Batch input must be JSON array like: [{"chrom":"chr1","pos":123},{"chrom":"chr2","pos":456}]');
    return;
  }
  const res = await fetch(`${base}/liftover/batch?from_build=hg19&to_build=hg38`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'X-API-Key': API_KEY },
    body: JSON.stringify(coords)
  });
  const json = await res.json();
  document.getElementById('batch-result').textContent = JSON.stringify(json, null, 2);
}

async function uploadVCF() {
  const f = document.getElementById('vcffile').files[0];
  if (!f) { alert('Select file'); return; }
  const fd = new FormData();
  fd.append('file', f);
  const res = await fetch(`${base}/vcf/convert?from_build=hg19&to_build=hg38`, {
    method: 'POST',
    headers: { 'X-API-Key': API_KEY },
    body: fd
  });
  const json = await res.json();
  document.getElementById('vcf-result').textContent = JSON.stringify(json, null, 2);
}

async function reconcileSemantic() {
  const gene = document.getElementById('sem-gene').value;
  const annsText = document.getElementById('sem-anns').value;
  let anns;
  try { anns = JSON.parse(annsText); } catch(e){ alert('annotations must be JSON array'); return; }
  const res = await fetch(`${base}/semantic/reconcile?gene_symbol=${encodeURIComponent(gene)}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'X-API-Key': API_KEY },
    body: JSON.stringify(anns)
  });
  const json = await res.json();
  document.getElementById('semantic-result').textContent = JSON.stringify(json, null, 2);
}